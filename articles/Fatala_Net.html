<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fatala fishes • EMtree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fatala fishes">
<meta property="og:description" content="EMtree">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EMtree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Fatala_Net.html">Fatala fishes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rmomal/EMtree">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fatala fishes</h1>
            
      
      
      <div class="hidden name"><code>Fatala_Net.Rmd</code></div>

    </div>

    
    
<p>This is a basic example detailing how to infer a network, using fishes counts from the Fatala River (Barans95 data from the <code>ade4</code> package).</p>
<div id="fatala-fishes-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#fatala-fishes-dataset" class="anchor"></a>Fatala fishes dataset</h2>
<p>The data is composed of 33 species abundances measures in 95 samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="http://pbil.univ-lyon1.fr/ADE-4">ade4</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://tibble.tidyverse.org">tibble</a></span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="kw">baran95</span>)
<span class="kw">Y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="kw">baran95</span><span class="op">$</span><span class="kw">fau</span>)
<span class="kw">n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="kw">Y</span>)
<span class="kw">p</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="kw">Y</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="kw">Y</span>[,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span>])
</pre></div>
<pre><code>##   AMA CAS CHI CHL CJO
## 1   0   2   0   3   0
## 2   0   1   0   0   0
## 3   0   2   0   3   0
## 4   0   0   0   2   0
## 5   0   0   0   0   0
## 6   0   0   0   0   0</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">Y</span>)
</pre></div>
<pre><code>##  int [1:95, 1:33] 0 0 0 0 0 0 0 0 0 0 ...
##  - attr(*, "dimnames")=List of 2
##   ..$ : chr [1:95] "1" "2" "3" "4" ...
##   ..$ : chr [1:33] "AMA" "CAS" "CHI" "CHL" ...</code></pre>
<p>The available covariates are the site and date of the samples. At each date and site, 4 samples were measured, except for kilometer 03 of January 93.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">X</span> <span class="op">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="kw">baran95</span><span class="op">$</span><span class="kw">plan</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">X</span>)
</pre></div>
<pre><code>## tibble [95 × 2] (S3: tbl_df/tbl/data.frame)
##  $ date: Factor w/ 6 levels "apr93","jun93",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ site: Factor w/ 4 levels "km03","km17",..: 1 1 1 1 2 2 2 2 3 3 ...</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="kw">X</span><span class="op">$</span><span class="kw">date</span>, <span class="kw">X</span><span class="op">$</span><span class="kw">site</span>)
</pre></div>
<pre><code>##        
##         km03 km17 km33 km46
##   apr93    4    4    4    4
##   jun93    3    4    4    4
##   aug93    4    4    4    4
##   oct93    4    4    4    4
##   dec93    4    4    4    4
##   feb94    4    4    4    4</code></pre>
</div>
<div id="network-inference" class="section level2">
<h2 class="hasAnchor">
<a href="#network-inference" class="anchor"></a>Network inference</h2>
<p>EMtree infers a network from either a correlation matrix of a multivariate Gaussian, or an object created by PLNmodels from count data. Therefore here we first create a <code>PLNmodels</code> object:</p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://jchiquet.github.io/PLNmodels">PLNmodels</a></span>)
<span class="kw">PLNfit</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/PLNmodels/man/PLN.html">PLN</a></span>(<span class="kw">Y</span> <span class="op">~</span> <span class="kw">X</span><span class="op">$</span><span class="kw">site</span>)
</pre></div>
<pre><code>## 
##  Initialization...
##  Adjusting a PLN model with full covariance model
##  Post-treatments...
##  DONE!</code></pre>
<p>And then run EMtree:</p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">EMtree</span>)
<span class="kw">EMtreeFit</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/EMtree.html">EMtree</a></span>(<span class="kw">PLNfit</span>,  maxIter = <span class="fl">20</span>, plot=<span class="fl">TRUE</span>)
</pre></div>
<pre><code>## 
## Likelihoods: 121.2481 , 121.3227 , 121.323 , 121.3231 , 121.3232 ,</code></pre>
<p><img src="Fatala_Net_files/figure-html/output-1.png" width="700"></p>
<pre><code>## 
## Convergence took 0.48 secs  and  5  iterations.</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">EMtreeFit</span>)
</pre></div>
<pre><code>## List of 6
##  $ edges_prob  : num [1:33, 1:33] 0.00 1.34e-05 1.39e-03 5.33e-02 1.11e-03 ...
##  $ edges_weight: num [1:33, 1:33] 0 0.000946 0.000946 0.000947 0.000946 ...
##  $ logpY       : num [1:5] 121 121 121 121 121
##  $ maxIter     : num 5
##  $ norm.cst    : num 2.07e-50
##  $ timeEM      : 'difftime' num 0.483907699584961
##   ..- attr(*, "units")= chr "secs"</code></pre>
<p>To get a network from afit of <code><a href="../reference/EMtree.html">EMtree()</a></code>, the probabilities stored in <code>edges_prob</code> can be thresholded. We propose the <span class="math inline">\(2/p\)</span> threshold as follows:</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">probs</span><span class="op">&lt;-</span> <span class="kw">EMtreeFit</span><span class="op">$</span><span class="kw">edges_prob</span>
<span class="kw">net</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">*</span>(<span class="kw">probs</span><span class="op">&gt;</span><span class="fl">2</span><span class="op">/</span><span class="kw">p</span>)
</pre></div>
<p>To improve the robstness, the function <code><a href="../reference/ResampleEMtree.html">ResampleEMtree()</a></code> implements a statibility selection of EMtree on S sub-samples. This function uses parallel computations with <code>mclapply()</code>. The output Pmat gathers all the infered edges probabilities for each sub-sample.</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">ResampEmtreeFit</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ResampleEMtree.html">ResampleEMtree</a></span>(counts=<span class="kw">Y</span>, covar_matrix = <span class="kw">X</span><span class="op">$</span><span class="kw">site</span> , S=<span class="fl">5</span>, maxIter=<span class="fl">10</span>,cond.tol=<span class="fl">1e-8</span>, cores=<span class="fl">1</span>)
</pre></div>
<pre><code>## Computing  5 probability matrices with 1 core(s)... 7.12 secs</code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">ResampEmtreeFit</span>)
</pre></div>
<pre><code>## List of 3
##  $ Pmat   : num [1:5, 1:528] 0.00022 0.00017 0.000572 0.002919 0.000638 ...
##  $ maxIter: num [1:5] 8 9 6 4 7
##  $ times  : 'difftime' num [1:5] 0.773567199707031 0.685011386871338 0.466330289840698 0.343677997589111 ...
##   ..- attr(*, "units")= chr "secs"</code></pre>
<p>Another way to specify the covariates matrix is to use the model.matrix() function as follows:</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="kw">built_covar_matrix</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(<span class="op">~</span><span class="kw">X</span><span class="op">$</span><span class="kw">site</span><span class="op">+</span><span class="kw">X</span><span class="op">$</span><span class="kw">date</span>)
</pre></div>
<p>Then <code>built_covar_matrix</code> would be the <code>covar_matrix</code> paramter.</p>
<p>For the sake of the example we continue with the <span class="math inline">\(site\)</span> covariate only. Edges selection frequencies can be derived from the <code>Pmat</code>output with the function <code><a href="../reference/freq_selec.html">freq_selec()</a></code>. A final network can then be obtained by thresholding the frequencies, to keep for example edges that are selected in more than <span class="math inline">\(80\%\)</span> of sub-samples:</p>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="kw">freqs</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/freq_selec.html">freq_selec</a></span>(<span class="kw">ResampEmtreeFit</span><span class="op">$</span><span class="kw">Pmat</span>,Pt=<span class="fl">2</span><span class="op">/</span><span class="kw">p</span><span class="op">+</span><span class="fl">0.1</span>)
<span class="kw">resampNet</span><span class="op">&lt;-</span><span class="fl">1</span><span class="op">*</span>(<span class="kw">freqs</span><span class="op">&gt;</span><span class="fl">0.8</span>)
</pre></div>
</div>
<div id="infer-networks-under-several-models" class="section level2">
<h2 class="hasAnchor">
<a href="#infer-networks-under-several-models" class="anchor"></a>Infer networks under several models:</h2>
<p>The aim of function <code><a href="../reference/ComparEMtree.html">ComparEMtree()</a></code> is to run network inference with different covariates specifications. It uses <code><a href="../reference/ResampleEMtree.html">ResampleEMtree()</a></code> and adjust the different models specified in <code>model_names</code> as follows:</p>
<div class="sourceCode" id="cb23"><pre class="downlit">
<span class="kw">tested_models</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>))
<span class="kw">models_names</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>,<span class="st">"site"</span>,<span class="st">"date + site"</span>)
<span class="kw">compare_models</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/ComparEMtree.html">ComparEMtree</a></span>(<span class="kw">Y</span>, <span class="kw">X</span>, models=<span class="kw">tested_models</span>, m_names=<span class="kw">models_names</span>, Pt=<span class="fl">2</span><span class="op">/</span><span class="kw">p</span><span class="op">+</span><span class="fl">0.1</span>,  S=<span class="fl">3</span>, maxIter=<span class="fl">5</span>,cond.tol=<span class="fl">1e-8</span>,cores=<span class="fl">1</span>)
</pre></div>
<pre><code>## model date : Computing  3 probability matrices with 1 core(s)... 6.34 secs
## model site : Computing  3 probability matrices with 1 core(s)... 3.97 secs
## model date + site : Computing  3 probability matrices with 1 core(s)... 5.83 secs</code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw">compare_models</span>)
</pre></div>
<pre><code>## tibble [1,584 × 4] (S3: tbl_df/tbl/data.frame)
##  $ node1 : chr [1:1584] "1" "1" "2" "1" ...
##  $ node2 : chr [1:1584] "2" "3" "3" "4" ...
##  $ model : chr [1:1584] "date" "date" "date" "date" ...
##  $ weight: num [1:1584] 0 0 0 0 0 ...</code></pre>
</div>
<div id="visuals" class="section level2">
<h2 class="hasAnchor">
<a href="#visuals" class="anchor"></a>Visuals</h2>
<p>Package Emtree provides with plotting functions for network visualizations. They build from the <code>ggraph</code> and <code>'tidygraph</code> packages.</p>
<div id="simple-networks" class="section level3">
<h3 class="hasAnchor">
<a href="#simple-networks" class="anchor"></a>Simple networks</h3>
<p>The function <code><a href="../reference/draw_network.html">draw_network()</a></code> takes a weighted matrix an input, and represent a network with edges widths proportional to the input weights. Several layouts are available (see the <code>ggraph</code> documentation). Highlighting of nodes possessing among the highest betweenness centrality measure is done with the parameter <code>btw_rank</code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit">
<span class="kw">probs</span>[<span class="kw">probs</span><span class="op">&lt;</span><span class="fl">2</span><span class="op">/</span><span class="kw">p</span>]<span class="op">=</span><span class="fl">0</span> 
<span class="fu"><a href="../reference/draw_network.html">draw_network</a></span>(<span class="kw">probs</span>,title=<span class="st">"Site"</span>, pal_edges=<span class="st">"dodgerblue3"</span>, layout=<span class="st">"nicely"</span>,btw_rank=<span class="fl">3</span>)<span class="op">$</span><span class="kw">G</span>
</pre></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-9-1.png" width="432"></p>
<p>From the selected edges frequencies:</p>
<div class="sourceCode" id="cb28"><pre class="downlit">
<span class="fu"><a href="../reference/draw_network.html">draw_network</a></span>(<span class="kw">resampNet</span>,<span class="st">"Site"</span>, layout=<span class="st">"nicely"</span>)<span class="op">$</span><span class="kw">G</span> 
</pre></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-10-1.png" width="432"></p>
</div>
<div id="facets-of-several-networks" class="section level3">
<h3 class="hasAnchor">
<a href="#facets-of-several-networks" class="anchor"></a>Facets of several networks</h3>
<p>The function<code><a href="../reference/compare_graphs.html">compare_graphs()</a></code> draws a facet plot of the output networks from <code><a href="../reference/ComparEMtree.html">ComparEMtree()</a></code>. Comparing network by eye is difficult, on particular choosing the right layout to do so is often troublesome. Here by default, the circle layout is used so that differences in density and sensitive nodes are easily seen.</p>
<div class="sourceCode" id="cb29"><pre class="downlit">
<span class="fu"><a href="../reference/compare_graphs.html">compare_graphs</a></span>(<span class="kw">compare_models</span>,shade=<span class="fl">TRUE</span>)<span class="op">$</span><span class="kw">G</span>
</pre></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-11-1.png" width="768"></p>
<p>However, if another layout is preferred, the nodes position is preserved along the facet and defined by choosing the <code>base_model</code>.</p>
<div class="sourceCode" id="cb30"><pre class="downlit">
<span class="fu"><a href="../reference/compare_graphs.html">compare_graphs</a></span>(<span class="kw">compare_models</span>,shade=<span class="fl">FALSE</span>, layout=<span class="st">"nicely"</span>, curv=<span class="fl">0.1</span>, base_model=<span class="st">"site"</span>)<span class="op">$</span><span class="kw">G</span>
</pre></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-12-1.png" width="768"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Raphaëlle Momal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
