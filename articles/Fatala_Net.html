<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fatala fishes â€¢ EMtree</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Fatala fishes">
<meta property="og:description" content="EMtree">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EMtree</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Fatala_Net.html">Fatala fishes</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Rmomal/EMtree">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Fatala fishes</h1>
            
      
      
      <div class="hidden name"><code>Fatala_Net.Rmd</code></div>

    </div>

    
    
<p>This is a basic example which shows you how to infer a network, using Barans95 data from the <code>ade4</code> package.</p>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ade4</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tibble</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">baran95</span>)
<span class="no">counts</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(<span class="no">baran95</span>$<span class="no">fau</span>)
<span class="no">covar</span> <span class="kw">=</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">baran95</span>$<span class="no">plan</span>)

<span class="no">n</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">counts</span>)
<span class="no">p</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">counts</span>)</pre></body></html></div>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">counts</span>)</pre></body></html></div>
<pre><code>##   AMA CAS CHI CHL CJO CST CTR CWA CYS DAF EFI ELA GDE GME HFA HFO IAF LFA LGR
## 1   0   2   0   3   0   0   0   0   0   0  71   1   5   6   0   0   7   3   3
## 2   0   1   0   0   0   0   0   0   0   0 118   2   3   0   0   0   8   1   7
## 3   0   2   0   3   0   0   0   0   0   0  69   0   6   2   0   0   8   3   0
## 4   0   0   0   2   0   0   0   0   0   0  56   0   0   0   0   0   1   0   2
## 5   0   0   0   0   0   0   0   0   3   0   0   1   1   0   0   0   2   2   5
## 6   0   0   0   0   0   0   0   0   5   0   0   0   2   0   0   0   0   0   9
##   LNI PAA PBR PEL PJU PLE PMO POQ PPA PQQ PTY SEB TIN TLE
## 1   0   0   5   2   9  26   0   4   0   0   0  22   0   2
## 2   0   0   0   0   0 113   0   1   0   0   1  18   0   1
## 3   0   0   1   0   3   0   0   1   0   0   0   3   0   0
## 4   0   0   0   0   0   0   0   0   0   0   0  15   0   0
## 5   0   0   0   3   0   0   0   4   0   0   3   0   0   0
## 6   0   0   2   4   4   0   2   0   0   0   1   0   0   0</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">covar</span>)</pre></body></html></div>
<pre><code>## # A tibble: 6 x 2
##   date  site 
##   &lt;fct&gt; &lt;fct&gt;
## 1 apr93 km03 
## 2 apr93 km03 
## 3 apr93 km03 
## 4 apr93 km03 
## 5 apr93 km17 
## 6 apr93 km17</code></pre>
</div>
<div id="fit-pln-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-pln-model" class="anchor"></a>Fit PLN model</h2>
<p>This creates a <code>PLNmodels</code> object</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">PLNmodels</span>)
<span class="no">model</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/PLNmodels/man/PLN.html">PLN</a></span>(<span class="no">counts</span> ~ <span class="no">covar</span>$<span class="no">site</span>)</pre></body></html></div>
<pre><code>## 
##  Initialization...
##  Adjusting a PLN model with full covariance model
##  Post-treatments...
##  DONE!</code></pre>
</div>
<div id="run-emtree-function" class="section level2">
<h2 class="hasAnchor">
<a href="#run-emtree-function" class="anchor"></a>Run EMtree function</h2>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">EMtree</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">3</span>)
<span class="no">output</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/EMtree.html">EMtree</a></span>(<span class="no">model</span>,  <span class="kw">maxIter</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">plot</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<pre><code>## 
## Likelihoods: -45.40118 , -45.33161 , -45.33147 , -45.33139 ,</code></pre>
<p><img src="Fatala_Net_files/figure-html/output-1.png" width="700"></p>
<pre><code>## 
## Convergence took 0.23 secs  and  4  iterations.
## Likelihood difference = 8.032151e-05 
## Betas difference = 2.251246e-09</code></pre>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">output</span>)</pre></body></html></div>
<pre><code>## List of 6
##  $ edges_prob  : num [1:33, 1:33] 0 0.00703 0.02019 0.14676 0.0321 ...
##  $ edges_weight: num [1:33, 1:33] 0 0.000946 0.000946 0.000948 0.000947 ...
##  $ logpY       : num [1:4] -45.4 -45.3 -45.3 -45.3
##  $ maxIter     : num 4
##  $ norm.cst    : num 2.07e-50
##  $ timeEM      : 'difftime' num 0.231255054473877
##   ..- attr(*, "units")= chr "secs"</code></pre>
</div>
<div id="foster-robustness-with-resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#foster-robustness-with-resampling" class="anchor"></a>Foster robustness with resampling :</h2>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">resample_output</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/ResampleEMtree.html">ResampleEMtree</a></span>(<span class="kw">counts</span><span class="kw">=</span><span class="no">counts</span>, <span class="kw">covar_matrix</span> <span class="kw">=</span> <span class="no">covar</span>$<span class="no">site</span> , <span class="kw">S</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">maxIter</span><span class="kw">=</span><span class="fl">10</span>,<span class="kw">cond.tol</span><span class="kw">=</span><span class="fl">1e-8</span>, <span class="kw">cores</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>## 
## S= 1   
## S= 2   
## S= 3   
## S= 4   
## S= 5</code></pre>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">resample_output</span>)</pre></body></html></div>
<pre><code>## List of 3
##  $ Pmat   : num [1:5, 1:528] 0.00118 0.00288 0.00504 0.01934 0.00641 ...
##  $ maxIter: num [1:5] 3 6 3 6 6
##  $ times  : 'difftime' num [1:5] 0.169563293457031 0.296403169631958 0.167448997497559 0.291896343231201 ...
##   ..- attr(*, "units")= chr "secs"</code></pre>
</div>
<div id="several-models-with-resampling" class="section level2">
<h2 class="hasAnchor">
<a href="#several-models-with-resampling" class="anchor"></a>Several models with resampling :</h2>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">parallel</span>)
<span class="no">tested_models</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fl">1</span>,<span class="fl">2</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>,<span class="fl">2</span>))
<span class="no">models_names</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"date"</span>,<span class="st">"site"</span>,<span class="st">"date + site"</span>)
<span class="no">compare_output</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/ComparEMtree.html">ComparEMtree</a></span>(<span class="no">counts</span>, <span class="kw">covar_matrix</span><span class="kw">=</span><span class="no">covar</span>, <span class="kw">models</span><span class="kw">=</span><span class="no">tested_models</span>, <span class="kw">m_names</span><span class="kw">=</span><span class="no">models_names</span>, <span class="kw">Pt</span><span class="kw">=</span><span class="fl">0.15</span>,  <span class="kw">S</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">maxIter</span><span class="kw">=</span><span class="fl">5</span>,<span class="kw">cond.tol</span><span class="kw">=</span><span class="fl">1e-8</span>,<span class="kw">cores</span><span class="kw">=</span><span class="fl">1</span>)</pre></body></html></div>
<pre><code>## 
## model  date
## S= 1   
## S= 2   
## S= 3   
## model  site
## S= 1   
## S= 2   
## S= 3   
## model  date + site
## S= 1   
## S= 2   
## S= 3</code></pre>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="no">compare_output</span>)</pre></body></html></div>
<pre><code>## tibble [1,584 Ã— 4] (S3: tbl_df/tbl/data.frame)
##  $ node1 : chr [1:1584] "1" "1" "2" "1" ...
##  $ node2 : chr [1:1584] "2" "3" "3" "4" ...
##  $ model : chr [1:1584] "date" "date" "date" "date" ...
##  $ weight: num [1:1584] 0 0 0 0 0 ...</code></pre>
</div>
<div id="visuals" class="section level2">
<h2 class="hasAnchor">
<a href="#visuals" class="anchor"></a>Visuals</h2>
<div id="from-emtree-output" class="section level3">
<h3 class="hasAnchor">
<a href="#from-emtree-output" class="anchor"></a>From <code>EMtree</code> output</h3>
<p>Simple network:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggraph</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidygraph</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">viridis</span>)

<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">200</span>)
<span class="no">edges_prob</span><span class="kw">&lt;-</span> <span class="no">output</span>$<span class="no">edges_prob</span>
<span class="no">edges_prob</span>[<span class="no">edges_prob</span><span class="kw">&lt;</span><span class="fl">2</span>/<span class="no">p</span>]<span class="kw">&lt;-</span><span class="fl">0</span>
<span class="fu"><a href="../reference/draw_network.html">draw_network</a></span>(<span class="no">edges_prob</span>,<span class="kw">title</span><span class="kw">=</span><span class="st">"Site"</span>, <span class="kw">pal</span><span class="kw">=</span><span class="st">"dodgerblue3"</span>, <span class="kw">layout</span><span class="kw">=</span><span class="st">"nicely"</span>,<span class="kw">curv</span><span class="kw">=</span><span class="fl">0.1</span>)$<span class="no">G</span></pre></body></html></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-5-1.png" width="432"></p>
</div>
<div id="from-resampleemtree-output" class="section level3">
<h3 class="hasAnchor">
<a href="#from-resampleemtree-output" class="anchor"></a>From <code>ResampleEMtree</code> output</h3>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">df</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/freq_selec.html">freq_selec</a></span>(<span class="no">resample_output</span>$<span class="no">Pmat</span>,<span class="kw">Pt</span><span class="kw">=</span><span class="fl">2</span>/<span class="no">p</span>+<span class="fl">0.1</span>)

<span class="fu"><a href="../reference/draw_network.html">draw_network</a></span>(<span class="no">df</span>,<span class="st">"Site"</span>, <span class="kw">layout</span><span class="kw">=</span><span class="st">"nicely"</span>)$<span class="no">G</span></pre></body></html></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-6-1.png" width="432"></p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">df</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">df</span><span class="kw">&lt;</span><span class="fl">1e-6</span>)]<span class="kw">=</span><span class="fl">0</span>
<span class="fu"><a href="../reference/draw_network.html">draw_network</a></span>(<span class="no">df</span>,<span class="st">"Site"</span>, <span class="kw">layout</span><span class="kw">=</span><span class="st">"nicely"</span>)$<span class="no">G</span></pre></body></html></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-6-2.png" width="432"></p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="../reference/draw_network.html">draw_network</a></span>(<span class="no">df</span>,<span class="st">"Site"</span>, <span class="kw">layout</span><span class="kw">=</span><span class="st">"nicely"</span>)$<span class="no">graph_data</span></pre></body></html></div>
<pre><code>## # A tbl_graph: 33 nodes and 74 edges
## #
## # An undirected simple graph with 3 components
## #
## # Node Data: 33 x 8 (active)
##     btw bool_btw bool_deg   deg title  name label finalcolor
##   &lt;dbl&gt; &lt;lgl&gt;    &lt;lgl&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt; &lt;lgl&gt;     
## 1  12.5 FALSE    TRUE         6 Site      1 ""    FALSE     
## 2  22   FALSE    TRUE         6 Site      2 ""    FALSE     
## 3   0   FALSE    TRUE         1 Site      3 ""    FALSE     
## 4   0   FALSE    TRUE         3 Site      4 ""    FALSE     
## 5   0   FALSE    TRUE         2 Site      5 ""    FALSE     
## 6   0   FALSE    TRUE         3 Site      6 ""    FALSE     
## # â€¦ with 27 more rows
## #
## # Edge Data: 74 x 6
##    from    to weight btw.weights neibs title
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;       &lt;dbl&gt; &lt;lgl&gt; &lt;chr&gt;
## 1     1     7    0.4       1.25  FALSE Site 
## 2     1     8    0.2       1.79  FALSE Site 
## 3     1    11    0.8       0.811 FALSE Site 
## # â€¦ with 71 more rows</code></pre>
</div>
<div id="facet-for-plotting-several-models-in-one-shot" class="section level3">
<h3 class="hasAnchor">
<a href="#facet-for-plotting-several-models-in-one-shot" class="anchor"></a>Facet for plotting several models in one shot</h3>
<p>Comparing network by eye is difficult. In particular, choosing the right layout to do so is often troublesome. Here by default, the circle layout is used so that differences in density are easily seen.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu"><a href="../reference/compar_graphs.html">compar_graphs</a></span>(<span class="no">compare_output</span>,<span class="kw">alpha</span><span class="kw">=</span><span class="fl">TRUE</span>)$<span class="no">G</span></pre></body></html></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-7-1.png" width="960"></p>
<p>However, the user can decide another layout. The nodes position is preserved along the networks.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="../reference/compar_graphs.html">compar_graphs</a></span>(<span class="no">compare_output</span>,<span class="kw">alpha</span><span class="kw">=</span><span class="fl">FALSE</span>, <span class="kw">layout</span><span class="kw">=</span><span class="st">"nicely"</span>, <span class="kw">curv</span><span class="kw">=</span><span class="fl">0.1</span>, <span class="kw">base_model</span><span class="kw">=</span><span class="st">"site"</span>)$<span class="no">G</span></pre></body></html></div>
<p><img src="Fatala_Net_files/figure-html/unnamed-chunk-8-1.png" width="960"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by RaphaÃ«lle Momal.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
